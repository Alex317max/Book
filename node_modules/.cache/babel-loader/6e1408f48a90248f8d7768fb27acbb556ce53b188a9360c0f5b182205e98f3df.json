{"ast":null,"code":"// src/components/MyBookingsTab.js\nimport React,{useState,useEffect,useCallback}from'react';import{fetchUserBookings,cancelUserBooking}from'../api';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const MyBookingsTab=()=>{const[fromDate,setFromDate]=useState(new Date().toISOString().split('T')[0]);const[toDate,setToDate]=useState(()=>{const date=new Date();date.setDate(date.getDate()+7);return date.toISOString().split('T')[0];});const[bookings,setBookings]=useState([]);const[isLoading,setIsLoading]=useState(false);const[error,setError]=useState('');const[message,setMessage]=useState({text:'',type:''});const loadUserBookings=useCallback(async()=>{// ... (логика проверки дат остается)\nif(!fromDate||!toDate){setError('Пожалуйста, выберите корректный диапазон дат.');setBookings([]);return;}const startDate=new Date(fromDate);const endDate=new Date(toDate);if(isNaN(startDate)||isNaN(endDate)||startDate>endDate){setError('Пожалуйста, выберите корректный диапазон дат.');setBookings([]);return;}setIsLoading(true);setError('');setMessage({text:'',type:''});try{const data=await fetchUserBookings(startDate,endDate);setBookings(data);if(data.length===0){setMessage({text:'Нет броней за выбранный период.',type:'info'});}}catch(err){setError(err.message||'Ошибка загрузки бронирований');setBookings([]);}finally{setIsLoading(false);}},[fromDate,toDate]);useEffect(()=>{loadUserBookings();},[loadUserBookings]);const handleCancelBooking=async bookingId=>{if(!window.confirm('Вы уверены, что хотите отменить это бронирование?'))return;try{await cancelUserBooking(bookingId);setMessage({text:'Бронь успешно отменена',type:'success'});loadUserBookings();}catch(err){setMessage({text:`Ошибка при отмене брони: ${err.message}`,type:'danger'});}setTimeout(()=>setMessage({text:'',type:''}),5000);};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-3 d-flex flex-wrap gap-2 align-items-end\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"from-date\",className:\"form-label\",children:\"\\u0421:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",id:\"from-date\",className:\"form-control\",value:fromDate,onChange:e=>setFromDate(e.target.value)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"to-date\",className:\"form-label\",children:\"\\u041F\\u043E:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",id:\"to-date\",className:\"form-control\",value:toDate,onChange:e=>setToDate(e.target.value)})]}),/*#__PURE__*/_jsx(\"button\",{id:\"load-bookings-button\",className:\"btn btn-primary\",onClick:loadUserBookings,disabled:isLoading,children:isLoading?'Загрузка...':'Показать'})]}),message.text&&/*#__PURE__*/_jsxs(\"div\",{className:`alert alert-${message.type} alert-dismissible fade show`,role:\"alert\",children:[message.text,/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",onClick:()=>setMessage({text:'',type:''}),\"aria-label\":\"Close\"})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"alert alert-danger\",children:error}),/*#__PURE__*/_jsxs(\"div\",{id:\"bookings-container\",children:[isLoading&&bookings.length===0&&/*#__PURE__*/_jsx(\"p\",{children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u043A\\u0430 \\u0431\\u0440\\u043E\\u043D\\u0438\\u0440\\u043E\\u0432\\u0430\\u043D\\u0438\\u0439...\"}),!isLoading&&!error&&bookings.length>0&&bookings.map(booking=>{const bookingDate=new Date(booking.booking_date);const displayDate=new Date(bookingDate.getUTCFullYear(),bookingDate.getUTCMonth(),bookingDate.getUTCDate());const dateStr=isNaN(displayDate)?'Неверная дата':displayDate.toLocaleDateString('ru-RU');// ОБНОВЛЕНО: Отображение time_slot\nconst timeSlotDisplay=booking.time_slot==='AM'?'Утро':booking.time_slot==='PM'?'Вечер':'';return/*#__PURE__*/_jsx(\"div\",{className:\"card mb-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card-body d-flex justify-content-between align-items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h5\",{className:\"card-title mb-1\",children:booking.desk_name||`Стол #${booking.desk_id}`}),/*#__PURE__*/_jsxs(\"p\",{className:\"card-text mb-0\",children:[dateStr,\" (\",timeSlotDisplay,\")\"]}),\" \",/*#__PURE__*/_jsxs(\"p\",{className:\"card-text text-muted mb-0\",children:[\"\\u041E\\u0444\\u0438\\u0441: \",booking.office_name]})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-outline-danger btn-sm\",onClick:()=>handleCancelBooking(booking.id),children:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0438\\u0442\\u044C\"})]})},booking.id);})]})]});};export default MyBookingsTab;","map":{"version":3,"names":["React","useState","useEffect","useCallback","fetchUserBookings","cancelUserBooking","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","MyBookingsTab","fromDate","setFromDate","Date","toISOString","split","toDate","setToDate","date","setDate","getDate","bookings","setBookings","isLoading","setIsLoading","error","setError","message","setMessage","text","type","loadUserBookings","startDate","endDate","isNaN","data","length","err","handleCancelBooking","bookingId","window","confirm","setTimeout","children","className","htmlFor","id","value","onChange","e","target","onClick","disabled","role","map","booking","bookingDate","booking_date","displayDate","getUTCFullYear","getUTCMonth","getUTCDate","dateStr","toLocaleDateString","timeSlotDisplay","time_slot","desk_name","desk_id","office_name"],"sources":["C:/Users/A.Ryazanov/book_test/front/src/components/MyBookingsTab.js"],"sourcesContent":["// src/components/MyBookingsTab.js\nimport React, { useState, useEffect, useCallback } from 'react';\nimport { fetchUserBookings, cancelUserBooking } from '../api';\n\nconst MyBookingsTab = () => {\n  const [fromDate, setFromDate] = useState(new Date().toISOString().split('T')[0]);\n  const [toDate, setToDate] = useState(() => {\n    const date = new Date();\n    date.setDate(date.getDate() + 7);\n    return date.toISOString().split('T')[0];\n  });\n  const [bookings, setBookings] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [message, setMessage] = useState({ text: '', type: '' });\n\n  const loadUserBookings = useCallback(async () => {\n    // ... (логика проверки дат остается)\n    if (!fromDate || !toDate) {\n      setError('Пожалуйста, выберите корректный диапазон дат.');\n      setBookings([]);\n      return;\n    }\n    const startDate = new Date(fromDate);\n    const endDate = new Date(toDate);\n\n    if (isNaN(startDate) || isNaN(endDate) || startDate > endDate) {\n      setError('Пожалуйста, выберите корректный диапазон дат.');\n      setBookings([]);\n      return;\n    }\n    \n    setIsLoading(true);\n    setError('');\n    setMessage({ text: '', type: '' });\n    try {\n      const data = await fetchUserBookings(startDate, endDate);\n      setBookings(data);\n      if (data.length === 0) {\n        setMessage({ text: 'Нет броней за выбранный период.', type: 'info' });\n      }\n    } catch (err) {\n      setError(err.message || 'Ошибка загрузки бронирований');\n      setBookings([]);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [fromDate, toDate]);\n\n  useEffect(() => {\n    loadUserBookings();\n  }, [loadUserBookings]);\n\n  const handleCancelBooking = async (bookingId) => {\n    if (!window.confirm('Вы уверены, что хотите отменить это бронирование?')) return;\n    try {\n      await cancelUserBooking(bookingId);\n      setMessage({ text: 'Бронь успешно отменена', type: 'success' });\n      loadUserBookings(); \n    } catch (err) {\n      setMessage({ text: `Ошибка при отмене брони: ${err.message}`, type: 'danger' });\n    }\n    setTimeout(() => setMessage({ text: '', type: '' }), 5000);\n  };\n\n  return (\n    <>\n      {/* ... (форма выбора дат и сообщения - без изменений) ... */}\n      <div className=\"mb-3 d-flex flex-wrap gap-2 align-items-end\">\n        <div>\n          <label htmlFor=\"from-date\" className=\"form-label\">С:</label>\n          <input \n            type=\"date\" \n            id=\"from-date\" \n            className=\"form-control\" \n            value={fromDate}\n            onChange={(e) => setFromDate(e.target.value)}\n          />\n        </div>\n        <div>\n          <label htmlFor=\"to-date\" className=\"form-label\">По:</label>\n          <input \n            type=\"date\" \n            id=\"to-date\" \n            className=\"form-control\" \n            value={toDate}\n            onChange={(e) => setToDate(e.target.value)}\n          />\n        </div>\n        <button \n          id=\"load-bookings-button\" \n          className=\"btn btn-primary\"\n          onClick={loadUserBookings}\n          disabled={isLoading}\n        >\n          {isLoading ? 'Загрузка...' : 'Показать'}\n        </button>\n      </div>\n\n      {message.text && (\n        <div className={`alert alert-${message.type} alert-dismissible fade show`} role=\"alert\">\n          {message.text}\n          <button type=\"button\" className=\"btn-close\" onClick={() => setMessage({text: '', type: ''})} aria-label=\"Close\"></button>\n        </div>\n      )}\n      {error && <div className=\"alert alert-danger\">{error}</div>}\n\n\n      <div id=\"bookings-container\">\n        {isLoading && bookings.length === 0 && <p>Загрузка бронирований...</p>}\n        {!isLoading && !error && bookings.length > 0 && bookings.map(booking => {\n          const bookingDate = new Date(booking.booking_date);\n          const displayDate = new Date(bookingDate.getUTCFullYear(), bookingDate.getUTCMonth(), bookingDate.getUTCDate());\n          const dateStr = isNaN(displayDate) ? 'Неверная дата' : displayDate.toLocaleDateString('ru-RU');\n          \n          // ОБНОВЛЕНО: Отображение time_slot\n          const timeSlotDisplay = booking.time_slot === 'AM' ? 'Утро' : (booking.time_slot === 'PM' ? 'Вечер' : '');\n\n          return (\n            <div key={booking.id} className=\"card mb-2\">\n              <div className=\"card-body d-flex justify-content-between align-items-center\">\n                <div>\n                  <h5 className=\"card-title mb-1\">{booking.desk_name || `Стол #${booking.desk_id}`}</h5>\n                  <p className=\"card-text mb-0\">{dateStr} ({timeSlotDisplay})</p> {/* Добавили слот */}\n                  <p className=\"card-text text-muted mb-0\">Офис: {booking.office_name}</p>\n                </div>\n                <button \n                  className=\"btn btn-outline-danger btn-sm\" \n                  onClick={() => handleCancelBooking(booking.id)}\n                >\n                  Отменить\n                </button>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </>\n  );\n};\n\nexport default MyBookingsTab;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}